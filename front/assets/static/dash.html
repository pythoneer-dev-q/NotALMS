<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>NotALMS ‚Äî –î–∞—à–±–æ—Ä–¥</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Oswald:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="icon" href="../../../favicon.ico" sizes="32x32">
    <script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" crossorigin="anonymous"></script>

    <style>
        :root {
            --primary: #6366f1;
            --bg: #0f172a;
            --panel: rgba(20, 40, 70, .9);
            --card: rgba(30, 60, 100, .85);
            --text: #e2e8f0;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Oswald', sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        /* ===== EMOJI UNIVERSAL STYLE ===== */
        /* –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å, —á—Ç–æ–±—ã —ç–º–æ–¥–∑–∏-–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å—Ç–æ—è–ª–∏ —Ä–æ–≤–Ω–æ –≤ —Ç–µ–∫—Å—Ç–µ */
        img.emoji {
            height: 1em;
            width: 1em;
            margin: 0 .05em 0 .1em;
            vertical-align: -0.1em;
        }

        /* ===== LOADER (–ò–∑ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞) ===== */
        .loader-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: .3s;
        }

        .loader-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-svg {
            width: 60px;
            /* –ß—É—Ç—å —É–≤–µ–ª–∏—á–∏–ª –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ */
            height: 60px;
            fill: var(--primary);
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 25px;
            background: var(--panel);
            border-bottom: 1px solid var(--primary);
        }

        .burger {
            font-size: 1.8rem;
            cursor: pointer;
        }

        .logo {
            font-family: 'Dela Gothic One';
            font-size: 1.8rem;
            color: var(--primary);
        }

        .user {
            color: white;
            text-decoration: none;
            border: 1px solid var(--primary);
            padding: 4px 10px;
            border-radius: 6px;
        }

        /* ===== MENU ===== */
        .menu {
            position: fixed;
            top: 0;
            left: -260px;
            width: 260px;
            height: 100%;
            background: var(--panel);
            padding: 25px;
            border-right: 1px solid var(--primary);
            transition: .3s;
            z-index: 100;
        }

        .menu.active {
            left: 0;
        }

        .menu button {
            width: 100%;
            margin-top: 20px;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            cursor: pointer;
        }

        /* ===== NEWS ===== */
        .announcements {
            margin: 20px 30px 0;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .news-card {
            flex: 1;
            background: var(--card);
            border-radius: 18px;
            padding: 16px 20px;
            border: 1px solid var(--primary);
            display: flex;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }

        .news-card::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: repeating-linear-gradient(45deg,
                    rgba(255, 255, 255, .04),
                    rgba(255, 255, 255, .04) 12px,
                    transparent 12px,
                    transparent 24px);
        }

        .news-emoji {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            background: rgba(255, 255, 255, .08);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            flex-shrink: 0;
        }

        .news-title {
            color: var(--primary);
            font-weight: 600;
            font-size: 1.05rem;
        }

        .news-desc {
            opacity: .9;
        }

        .arrow {
            font-size: 2.2rem;
            cursor: pointer;
            opacity: .6;
            user-select: none;
        }

        .arrow:hover {
            opacity: 1;
        }

        /* ===== MOBILE ===== */
        @media(max-width:600px) {
            .announcements {
                margin: 12px 15px 0;
                gap: 8px;
            }

            .news-card {
                padding: 10px 12px;
                border-radius: 14px;
            }

            .news-emoji {
                width: 40px;
                height: 40px;
                font-size: 1.6rem;
            }

            .news-title {
                font-size: .9rem;
            }

            .news-desc {
                font-size: .8rem;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .arrow {
                font-size: 1.6rem;
            }
        }

        /* ===== CONTENT ===== */
        .content {
            padding: 30px;
        }

        .courses {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .course {
            background: var(--card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--primary);
            cursor: pointer;
            transition: .3s;
        }

        .course:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(99, 102, 241, .35);
        }

        .course h3 {
            margin: 0 0 10px;
            color: var(--primary);
        }
    </style>
</head>

<body>

    <div id="global-loader" class="loader-overlay hidden">
        <svg class="loader-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25" />
            <path
                d="M10.72,19.9a8,8,0,0,1-6.5-9.79A7.77,7.77,0,0,1,10.4,4.16a8,8,0,0,1,9.49,6.52A1.54,1.54,0,0,0,21.38,12h.13a1.37,1.37,0,0,0,1.38-1.54,11,11,0,1,0-12.7,12.39A1.54,1.54,0,0,0,12,21.34h0A1.47,1.47,0,0,0,10.72,19.9Z">
                <animateTransform attributeName="transform" type="rotate" dur="0.75s" values="0 12 12;360 12 12"
                    repeatCount="indefinite" />
            </path>
        </svg>
    </div>

    <div class="menu" id="menu">
        <h3>–ú–µ–Ω—é</h3>
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>

    <header class="header">
        <div class="burger" onclick="toggleMenu()">‚ò∞</div>
        <div class="logo">NotALMS</div>
        <a href="/profile" class="user" id="user-name">...</a>
    </header>

    <div class="announcements" id="announcements" style="display:none">
        <div class="arrow" id="newsPrev">‚Äπ</div>

        <div class="news-card">
            <div class="news-emoji" id="newsEmoji">üì¢</div>
            <div>
                <div class="news-title" id="newsTitle"></div>
                <div class="news-desc" id="newsText"></div>
            </div>
        </div>

        <div class="arrow" id="newsNext">‚Ä∫</div>
    </div>

    <main class="content">
        <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—Å—ã</h2>
        <div id="courses" class="courses"></div>
    </main>

    <script>
        const API = 'https://lmsapi.cloudpub.ru/v1';
        const token = localStorage.getItem('token');
        if (!token) location.href = '/';

        const loader = document.getElementById('global-loader');
        const coursesBox = document.getElementById('courses');

        let news = [], index = 0, timer = null;

        function toggleMenu() {
            document.getElementById('menu').classList.toggle('active');
        }

        function logout() {
            localStorage.removeItem('token');
            location.href = '/';
        }

        async function apiGet(url) {
            const r = await fetch(API + url, {
                headers: { Authorization: `Bearer ${token}` }
            });
            if (!r.ok) throw new Error();
            return r.json();
        }

        /* ===== NEWS ===== */

        function renderNews() {
            const n = news[index];

            const emojiEl = document.getElementById('newsEmoji');
            emojiEl.textContent = n.emoji || 'üì¢';

            const titleEl = document.getElementById('newsTitle');
            titleEl.textContent = n.title || '';

            const textEl = document.getElementById('newsText');
            textEl.textContent = n.text || '';

            // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —ç–º–æ–¥–∑–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π
            // folder: 'svg' –¥–µ–ª–∞–µ—Ç —ç–º–æ–¥–∑–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –∏ —á–µ—Ç–∫–∏–º–∏
            twemoji.parse(document.querySelector('.news-card'), { folder: 'svg', ext: '.svg' });
        }

        function startAuto() {
            clearInterval(timer);
            timer = setInterval(() => {
                index = (index + 1) % news.length;
                renderNews();
            }, 30000);
        }

        async function loadNews() {
            try {
                const data = await apiGet('/lastnews');
                if (!Array.isArray(data) || !data.length) return;

                news = data;
                document.getElementById('announcements').style.display = 'flex';
                renderNews();
                startAuto();
            } catch { }
        }

        document.getElementById('newsPrev').onclick = () => {
            index = (index - 1 + news.length) % news.length;
            renderNews();
            startAuto();
        };

        document.getElementById('newsNext').onclick = () => {
            index = (index + 1) % news.length;
            renderNews();
            startAuto();
        };

        /* ===== COURSES ===== */

        async function loadCourses() {
            const list = await apiGet('/courses');
            coursesBox.innerHTML = '';
            list.forEach(c => {
                const el = document.createElement('div');
                el.className = 'course';
                // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫—É—Ä—Å–∞, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
                el.innerHTML = `
          <h3>${c.title}</h3>
          <div>${c.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
        `;
                el.onclick = () => location.href = `/course/${c._id || c.id}`;
                coursesBox.appendChild(el);
            });
            // –ü–∞—Ä—Å–∏–º —ç–º–æ–¥–∑–∏ –≤–æ –≤—Å–µ–º –±–ª–æ–∫–µ –∫—É—Ä—Å–æ–≤
            twemoji.parse(coursesBox, { folder: 'svg', ext: '.svg' });
        }

        /* ===== INIT ===== */

        (async () => {
            try {
                loader.classList.remove('hidden');

                const me = await apiGet('/me');
                document.getElementById('user-name').textContent = me.user_login;

                // –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –∫—Ä–∞—Å–∏–≤–æ –ø–æ–∫–∞–∑–∞—Ç—å –ª–æ–∞–¥–µ—Ä (–ø–æ –∂–µ–ª–∞–Ω–∏—é –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å)
                // await new Promise(r => setTimeout(r, 500)); 

                loader.classList.add('hidden');
                setTimeout(() => loader.remove(), 300);

                await loadNews();
                await loadCourses();

            } catch (e) {
                loader.remove();
                document.querySelector('.content').innerHTML =
                    '<div style="text-align:center;color:#ef4444;margin-top:40px;font-size:1.2rem">–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞ –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏</div>';
            }
        })();
    </script>

</body>

</html>